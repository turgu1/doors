<body onload="set_session(); #{S}">
  <h1>Gestion des portes</h1>
  <div class="alert-#{SEVERITY_0}">#{MSG_0}</div>
  <hr/>
  <div class="alert-#{SEVERITY_1}">#{MSG_1}</div>
  <table>
    <tbody>
      <tr class="#{ACTIVE_0}">
        <td class="label">#{NAME_0}:</td>
        <td><a class="button button2 std" href="./open?door=0">Ouvre</a></td>
        <td><a class="button button3 std" href="./close?door=0">Ferme</a></td>
      </tr>
      <tr class="#{ACTIVE_1}">
        <td class="label">#{NAME_1}:</td>
        <td><a class="button button2 std" href="./open?door=1">Ouvre</a></td>
        <td><a class="button button3 std" href="./close?door=1">Ferme</a></td>
      </tr>
      <tr class="#{ACTIVE_2}">
        <td class="label">#{NAME_2}:</td>
        <td><a class="button button2 std" href="./open?door=2">Ouvre</a></td>
        <td><a class="button button3 std" href="./close?door=2">Ferme</a></td>
      </tr>
      <tr class="#{ACTIVE_3}">
        <td class="label">#{NAME_3}:</td>
        <td><a class="button button2 std" href="./open?door=3">Ouvre</a></td>
        <td><a class="button button3 std" href="./close?door=3">Ferme</a></td>
      </tr>
      <tr class="#{ACTIVE_4}">
        <td class="label">#{NAME_4}:</td>
        <td><a class="button button2 std" href="./open?door=4">Ouvre</a></td>
        <td><a class="button button3 std" href="./close?door=4">Ferme</a></td>
      </tr>
    </tbody>
  </table>
  <hr/>
  <a onclick="check_session();" ontouchend="check_session();" class="button button1 medium">Configuration</a>
  <div id="ask_form" style="display: none;">
    <br/><br/>
    <form action="./config" method="post">
      <div>
        <label for="MP">Code d'accès: </label><br/>
        <input type="text" class="password" autocomplete="off" maxlength="15" name="MP" id="MP" required title="Code d'accès" value="" style="margin-top:4px;"><br/>
        <input type="submit" value="OK" class="submit button button2 small" style="margin-top:4px;">
      </div>
    </form>
  </div>
  <script>
    function check_session() {
      if ((sessionStorage.getItem("m") == null) || (sessionStorage.getItem("m") == "timeout")) {
        document.getElementById("ask_form").style.display = "block";
        document.getElementById("MP").focus();
      }
      else {
        window.location.href = "./config";
      }
    }
    function set_session() {
      if (#{M} != null) {
        sessionStorage.setItem("m", #{M});
        if (sessionStorage.getItem("m") == "timeout") {
          document.getElementById("ask_form").style.display = "block";
          document.getElementById("MP").focus();
        }
      }
      else {
        sessionStorage.removeItem("m");
      }
    }
    function lien() {
      window.location.href = this.href;
      return true;
    }

    document.querySelectorAll(".std").forEach(function (item) {
      item.addEventListener('click', lien);
      item.addEventListener('touchend', lien);
    });
  </script>
</body>
</html>
